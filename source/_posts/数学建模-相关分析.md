---
title: 数学建模-相关分析
date: 2021-05-14 20:01:00
mathjax: true
tag: [数学建模]
---



# 相关分析

衡量两个变量因素的相关密切程度，看是否存在关系。

也存在一类 **系统分析问题**，多个因素决定系统的发展趋势，确定哪些是主要因素，哪些是次要因素；哪些因素对系统发展影响大，哪些因素对系统发展影响小；哪些因素起强化作用，哪些因素起弱化作用。

相关性不一定等于因果性。

Y 为因变量，存在连续数值型变量，0-1 型变量，定序变量，计数变量，生存变量等类型。

# 灰色关联分析

自变量、因变量关系分析。

使用软件：Matlab。

灰色关联分析的基本思想是根据 **序列曲线几何形状** 的 **相似程度** 来判断其联系是否紧密。

分析图，可以发现 2003-2004 的突变趋势对 主序列 的影响较大。

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210420195641425.png)



![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210420195712666.png)

## Matlab 使用

```matlab
load gdp.mat 
Mean = mean(gdp);
gdp = gdp ./ repmat(Mean, size(gdp, 1), 1);
disp('预处理后的矩阵为：')
disp(gdp)
Y = gdp(:, 1);  % 母序列
X = gdp(:, 2:end); % 子序列
absX0_Xi = abs(X - repmat(Y, 1, size(X,2)))  % 计算|X0-Xi|矩阵(在这里我们把X0定义为了Y)
a = min(min(absX0_Xi))  % 计算两级最小差a
b = max(max(absX0_Xi))  % 计算两级最大差b
absX0_Xi = abs(X - repmat(Y, 1, size(X,2)))  % 计算|X0-Xi|矩阵(在这里我们把X0定义为了Y)
a = min(min(absX0_Xi))  % 计算两级最小差a
b = max(max(absX0_Xi))  % 计算两级最大差b
rho = 0.5; % 分辨系数取0.5
gamma = (a + rho * b) ./ (absX0_Xi  + rho * b) % 计算子序列中各个指标与母序列的关联系数
disp('子序列中各个指标的灰色关联度分别为：')
disp(mean(gamma))
```

# 相关系数

变量间关系分析。

使用软件：SPSS，Matlab。

相关系数只是用来衡量两个变量 **线性相关** 程度的指标；也就是说，你必须 **先确认** 这两个变量是线性相关的，然后这个相关系数才能告诉你他俩相关程度如何。

## Pearson 系数

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421194933248.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421194955219.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421195246218.png)

标准化去除了量纲的影响，由于抽取的基本上都是样本，所以一般都是除以 $n-1$。

### 操作注意点

注意点：所以在 Pearson 系数大的时候，还要画出散点图来查看，通过 SPSS 软件：

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210514185558014.png)

相关系数还要查看他的显著性水平（是不是对大多数数据符合规律，所以要进行假设检验）。

可对各组数据之间计算 R 值相关性系数，表格表示各组之间的关系时可美化。

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421195558884.png)

### 数据分布检验

除了预先画出散点图，感觉满足线性关系时，还要保证实验数据为正态分布。

#### JB 检验

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421204346020.png)

```matlab
x = normrnd(2,3,100,1);   % 生成100*1的随机向量，每个元素是均值为2，标准差为3的正态分布
skewness(x)  %偏度
kurtosis(x)  %峰度

n_c = size(Test,2);
H = zeros(1,6);
P = zeros(1,6);
% 对所有列数据进行 JB 检验
for i = 1:n_c
    [h,p] = jbtest(Test(:,i),0.05);
    H(i)=h;
    P(i)=p;
end

#### Shapiro-wilk 检验

小样本检验，$3 \le n \le 50$。

使用 SPSS 检验。

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421205227669.png)

#### Q-Q 图检验

要求数据量大。

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421205431670.png)

​```matlab
% Q-Q图
x = normrnd(2, 3, 100,1);   % 生成100*1的随机向量，每个元素是均值为2，标准差为3的正态分布
qqplot(x)
qqplot(Test(:,1))
```

### 相关显著性检验

- 检验方法1

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421201421230.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421201614358.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421201715997.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421202030428.png)

```matlab
R = corrcoef(Test); % 对 R 进行检验
x = -4:0.1:4;
y = tpdf(x, 28); % 求t分布的概率密度值 28 是自由度  
figure(1)
plot(x, y, '-')
grid on 
hold on 
tinv(0.975,28)    % 可以求出 t分布临界值，0.975 双侧检验 2.0484
plot([-2.048, -2.048], [0, tpdf(-2.048, 28)], 'r-')
plot([2.048, 2.048], [0, tpdf(2.048, 28)], 'r-')
```

- 检验方法2

更好的方法，$p$ 值检验法。

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421203644249.png)

```matlab
x = -4:0.1:4;
y = tpdf(x, 28);
figure(2)
plot(x, y, '-')
grid on 
hold on
plot([-3.055, -3.055], [0, tpdf(-3.055, 28)], 'r-')
plot([3.055, 3.055], [0, tpdf(3.055, 28)], 'r-')
disp('该检验值对应的p值为：')
disp((1 - tcdf(3.055, 28)) * 2)  % 双侧检验的p值要乘以2

[R,P] = corrcoef(Test) % 可用函数直接得出
P < 0.01  % 标记3颗星的位置
(P < 0.05) .* (P > 0.01)  % 标记2颗星的位置
(P < 0.1) .* (P > 0.05) % 标记1颗星的位置
```

## Spearman 系数

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421210006709.png)

**小样本情况**

$n \le 30$ 时，可直接使用相关系数查临界值表。

**大样本情况**

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210421210511266.png)



```matlab
% 计算矩阵各列的斯皮尔曼相关系数
R = corr(Test, 'type' , 'Spearman')
% 计算检验值
disp(sqrt(590)*0.0301)
% 计算p值
disp((1 - normcdf(0.7311))  *2) % normcdf用来计算标准正态分布的累积概率密度函数

% 直接给出相关系数和p值
[R,P] = corr(Test, 'type' , 'Spearman')
```

## 使用对比

Spearman 相关系数和 Pearson 相关系数选择:

1. 连续数据，正态分布，线性关系，用 Pearson 相关系数是最恰当，Spearman 相关系数效率没有 Pearson 相关系数高。

2. 上述任一条件不满足，就用spearman相关系数，不能用 Pearson 相关系数。

3. 两个定序数据之间也用spearman相关系数，不能用 Pearson 相关系数。定序数据是指仅仅反映观测对象等级、顺序关系的数据。

# 主成分分析

自变量降维分析。

解决问题所需软件：Matlab，其后可用 SPSS 来聚类或 Stata 来回归。

主成分分析是一种 **降维** 算法，它能将多个指标转换为少数几个主成分，这些主成分是 **原始变量的线性组合**，且彼此之间互不 **相关**，其能反映出原始数据的大部分信息。一般来说，当研究的问题涉及到多变量且变量之间存在很强的 **相关性** 时，我们可考虑使用主成分分析的方法来对数据进行简化。

**降维** 是将高维度的数据（指标太多）保留下最重要的一些特征，去除噪声和不重要的特征，从而实现提升数据处理速度的目的。在实际的生产和应用中，降维在一定的信息损失范围内，可以为我们节省大量的时间和成本。降维也成为应用非常广泛的数据预处理方法。

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508162157747.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508162228401.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508162533412.png)

## 关键步骤

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508162737695.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508162839541.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508162950556.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508163028637.png)

## 例题引入

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508163415533.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508163436478.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508163536678.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508164338562.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508164359073.png)

## 分析说明

在主成分分析中，我们首先应保证所提取的前几个主成分的累计贡献率达到一个较高的水平，其次对这些被提取的主成分必须都能够给出符合实际背景和意义的解释。

主成分的解释其含义一般多少带有点模糊性，不像原始变量的含义那么清楚、确切，这是变量降维过程中不得不付出的代价。因此，提取的主成分个数 m 通常应明显小于原始变量个数 p（除非 p 本身较小），否则维数降低的 “利” 可能抵不过主成分含义不如原始变量清楚的 “弊”。

主成分分析的困难之处主要在于要能够给出主成分的较好解释，所提取的主成分中如有一个主成分解释不了，整个主成分分析也就失败了。主成分分析是变量降维的一种重要、常用的方法，简单的说，该方法要应用得成功，一是靠原始变量的合理选取，二是靠 “运气” 。

主成分分析不可用于评价分析：

- 主成分是降维算法，你既然已经有数据了，为什么不把这些数据的信息全部用上呢？主成分分析是会损失原始数据的信息的。
- 指标可能有各种类型（极大、极小、区间等），主成分只有标准化的过程，并没有正向化的过程。

可用于 **聚类** ，计算出第一主成分和第二主成分的值，将其视为两个新的指标（可以在图上直观的展示各样本的分布情况）。主成分聚类最大的意义就是能帮我们可视化最后的聚类效果，毕竟，使用主成分是会降低部分信息的。言外之意，只有在指标个数特别多，且指标之间存在很强的相关性时才用主成分聚类。

可用于 **回归**，可用来解决 *多重共线性* 的问题。

## Matlab 使用

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508165044308.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508165309359.png)

```matlab
load data1.mat   % 主成分聚类
[n,p] = size(x);  % n是样本个数，p是指标个数

X = zscore(x); R = cov(X); % matlab内置的标准化函数（x-mean(x)）/std(x)
%% 或者
R = corrcoef(x);
disp('样本相关系数矩阵为：')
disp(R)

[V,D] = eig(R);  % V 特征向量矩阵  D 特征值构成的对角矩阵
lambda = diag(D);  % diag函数用于得到一个矩阵的主对角线元素值(返回的是列向量)
lambda = lambda(end:-1:1);  % 因为lambda向量是从小大到排序的，将其调头
contribution_rate = lambda / sum(lambda);
cum_contribution_rate = cumsum(lambda)/ sum(lambda); % cumsum是求累加值的函数
disp('特征值为：')
disp(lambda')  % 转置为行向量，方便展示
disp('贡献率为：')
disp(contribution_rate')
disp('累计贡献率为：')
disp(cum_contribution_rate')
disp('与特征值对应的特征向量矩阵为：')
%  rot90函数可以使一个矩阵逆时针旋转90度，然后再转置，就可以实现将矩阵的列颠倒的效果
V=rot90(V)';
disp(V)

m =input('请输入需要保存的主成分的个数:  ');
F = zeros(n,m);
for i = 1:m
    ai = V(:,i)';   % 将第i个特征向量取出，并转置为行向量
    Ai = repmat(ai,n,1);   % 将这个行向量重复n次，构成一个n*p的矩阵
    F(:, i) = sum(Ai .* X, 2);  % 注意，对标准化的数据求了权重后要计算 每一行 的和
end

%% (1)主成分聚类 ： 将主成分指标所在的F矩阵复制到Excel表格，然后再用Spss进行聚类
% 在Excel第一行输入指标名称（F1,F2, ..., Fm）
% 双击Matlab工作区的F,进入变量编辑中，然后复制里面的数据到Excel表格
% 导出数据之后，我们后续的分析就可以在Spss中进行。

%% (2)主成分回归：将x使用主成分得到主成分指标，并将y标准化，接着导出到Excel，然后再使用Stata回归
% Y = zscore(y);  % 一定要将y进行标准化
% 在Excel第一行输入指标名称（Y,F1, F2, ..., Fm）
% 分别双击Matlab工作区的Y和F,进入变量编辑中，然后复制里面的数据到Excel表格
% 导出数据之后，我们后续的分析就可以在Stata中进行。
```

提取完两个主成分后，可用于在 Stata 中进行回归。

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508165536454.png)

# 因子分析

自变量降维分析。

解决问题所需软件：SPSS。

*因子分析法* 通过研究变量间的相关系数矩阵，把这些变量间错综复杂的关系 **归结** 成少数几个 **综合因子**，由于归结出的因子个数少于原始变量的个数，但是它们又包含原始变量的信息，所以，这一分析过程也称为 **降维**。由于因子往往比主成分更易得到解释，故因子分析比主成分分析更容易成功，从而有更广泛的应用。

## 与主成分分析对比

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508203145668.png)

## 例题引入

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508203232019.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508203304085.png)

## 关键步骤

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508203454702.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508203625074.png)

*为什么这样假设？* 

- 公因子彼此不相关，且具有单位方差（标准化消除量纲）
- 特殊因子彼此不相关且与公因子也不相关

*这样做有什么好处？*

因子载荷矩阵 A 可以不是唯一的，可以利用这一点，通过因子的变换，使得新的因子具有更容易 **解释** 的实际意义。

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508204728753.png)

## 载荷因子的统计意义

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508204849749.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508204925245.png)

## SPSS 操作

### 方法及分析意义

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508205412475.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508205747875.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508205914993.png)

因子可以通过 *正交矩阵*  旋转，重新解释。得到因子模型后，其中的公共因子不一定能反映问题的实质特征，为了能更好地解释每一个公共因子的实际意义，且减少解释的主观性，可以通过 *因子旋转* 达到目的。*因子旋转* 分为正交旋转与斜交旋转，经过正交旋转而得到的新的公共因子仍然保持彼此独立的性质，而斜交旋转得到的公共因子是相关的（违背了最初的假定，因此可以看作传统因子分析的拓展），其实际意义更容易解释。但不论是正交旋转还是斜交旋转，都应当使新公共因子的载荷系数（每个 $\alpha$）的绝对值尽可能接近 0 或 1（这里默认了我们从相关系数矩阵进行计算），**方便解释**。

可以再对因子进行评价：因子分析是将变量表示为公共因子和特殊因子的线性组合，此外，我们可以 **反过来** 将公共因子表示为原变量的线性组合，即可得到 *因子得分*。

### 操作步骤

1）先检验原始数据是否适合进行因子分析，并确定参考因子个数

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508205959016.png)

KMO检验和巴特利特球形检验（样本数要大于指标数）：

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508210313246.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508210337939.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508210414169.png)

2）调整因子个数后重新计算

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508210442619.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508210801673.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508210856963.png)

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508211323798.png)

旋转后的成分矩阵更易于解释：比如成分 1 可以解释为持久力，成分 2 可以解释为爆发力。

还可以用 *因子得分* 做一些跟 *主成分分析* 一样的事：

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210508211552172.png)

# 典型相关分析

自变量组相关分析。

解决问题所需软件：SPSS。

研究 **两组** 变量之间相关关系的一种多元统计方法。（每组变量中都可能有 **多个** 指标）

## 例题引入

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210510201610695.png)

直接对这些变量的相关进行两两分析（*相关性分析*），很难得到关于这 **两组** 变量（如观众和业内人士）之间关系的一个清楚的印象。

*典型相关分析* 把多个变量与多个变量之间的相关化为两个具有代表性的变量之间的相关。

*每组选谁最代表？* 一组变量最简单的综合形式就是该组变量的 **线性组合**。

被选出的线性组合配对称为典型变量，它们的相关系数称为 **典型相关系数**。

![](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210510202637947.png)

## 关键步骤

1. 数据分布假设

   两组数据服从联合正态分布。

2. 两组变量的相关性检验

   构造似然比统计量，p 值小于 0.05 表示在 95% 的置信水平（5% 的显著性水平）下拒绝原假设，即认为两组变量有关。

3. 确定典型变量的个数

   直接看典型相关系数对应的 p 值即可，说明可以使用该典型相关系数。

4. 利用标准化后的典型相关变量分析问题

   消除量纲的影响。

5. 进行典型载荷分析（对可使用的典型相关系数）

   ![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210510211844171.png)

6. 进行典型变量对样本总方差的贡献分析

   ![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210510213019784.png)

## SPSS 操作

### 操作步骤

![](https://hauk-blog.oss-cn-hangzhou.aliyuncs.com/blogimage-20210511134628445.png)

### 分析要点

![](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210510213247959.png)

![](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210510213324032.png)

